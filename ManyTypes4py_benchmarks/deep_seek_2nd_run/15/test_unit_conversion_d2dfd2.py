"""Test Home Assistant unit conversion utility functions."""
from __future__ import annotations
import inspect
from itertools import chain
from typing import Any, Dict, List, Tuple, Type, Union
import pytest
from homeassistant.const import CONCENTRATION_PARTS_PER_BILLION, CONCENTRATION_PARTS_PER_MILLION, PERCENTAGE, UnitOfArea, UnitOfBloodGlucoseConcentration, UnitOfConductivity, UnitOfDataRate, UnitOfElectricCurrent, UnitOfElectricPotential, UnitOfEnergy, UnitOfEnergyDistance, UnitOfInformation, UnitOfLength, UnitOfMass, UnitOfPower, UnitOfPressure, UnitOfSpeed, UnitOfTemperature, UnitOfTime, UnitOfVolume, UnitOfVolumeFlowRate, UnitOfVolumetricFlux
from homeassistant.exceptions import HomeAssistantError
from homeassistant.util import unit_conversion
from homeassistant.util.unit_conversion import AreaConverter, BaseUnitConverter, BloodGlucoseConcentrationConverter, ConductivityConverter, DataRateConverter, DistanceConverter, DurationConverter, ElectricCurrentConverter, ElectricPotentialConverter, EnergyConverter, EnergyDistanceConverter, InformationConverter, MassConverter, PowerConverter, PressureConverter, SpeedConverter, TemperatureConverter, UnitlessRatioConverter, VolumeConverter, VolumeFlowRateConverter

INVALID_SYMBOL: str = 'bob'
_ALL_CONVERTERS: Dict[Type[BaseUnitConverter], List[str]] = {
    converter: sorted(converter.VALID_UNITS, key=lambda x: (x is None, x)) 
    for converter in (
        AreaConverter, BloodGlucoseConcentrationConverter, ConductivityConverter, 
        DataRateConverter, DistanceConverter, DurationConverter, ElectricCurrentConverter, 
        ElectricPotentialConverter, EnergyConverter, InformationConverter, MassConverter, 
        PowerConverter, PressureConverter, SpeedConverter, TemperatureConverter, 
        UnitlessRatioConverter, EnergyDistanceConverter, VolumeConverter, VolumeFlowRateConverter
    )
}

_GET_UNIT_RATIO: Dict[Type[BaseUnitConverter], Tuple[str, str, float]] = {
    AreaConverter: (UnitOfArea.SQUARE_KILOMETERS, UnitOfArea.SQUARE_METERS, 1e-06),
    BloodGlucoseConcentrationConverter: (UnitOfBloodGlucoseConcentration.MILLIGRAMS_PER_DECILITER, UnitOfBloodGlucoseConcentration.MILLIMOLE_PER_LITER, 18),
    ConductivityConverter: (UnitOfConductivity.MICROSIEMENS_PER_CM, UnitOfConductivity.MILLISIEMENS_PER_CM, 1000),
    DataRateConverter: (UnitOfDataRate.BITS_PER_SECOND, UnitOfDataRate.BYTES_PER_SECOND, 8),
    DistanceConverter: (UnitOfLength.KILOMETERS, UnitOfLength.METERS, 0.001),
    DurationConverter: (UnitOfTime.MINUTES, UnitOfTime.SECONDS, 1 / 60),
    ElectricCurrentConverter: (UnitOfElectricCurrent.AMPERE, UnitOfElectricCurrent.MILLIAMPERE, 0.001),
    ElectricPotentialConverter: (UnitOfElectricPotential.MILLIVOLT, UnitOfElectricPotential.VOLT, 1000),
    EnergyConverter: (UnitOfEnergy.WATT_HOUR, UnitOfEnergy.KILO_WATT_HOUR, 1000),
    EnergyDistanceConverter: (UnitOfEnergyDistance.MILES_PER_KILO_WATT_HOUR, UnitOfEnergyDistance.KM_PER_KILO_WATT_HOUR, 0.621371),
    InformationConverter: (UnitOfInformation.BITS, UnitOfInformation.BYTES, 8),
    MassConverter: (UnitOfMass.STONES, UnitOfMass.KILOGRAMS, 0.157473),
    PowerConverter: (UnitOfPower.WATT, UnitOfPower.KILO_WATT, 1000),
    PressureConverter: (UnitOfPressure.HPA, UnitOfPressure.INHG, 33.86389),
    SpeedConverter: (UnitOfSpeed.KILOMETERS_PER_HOUR, UnitOfSpeed.MILES_PER_HOUR, 1.609343),
    TemperatureConverter: (UnitOfTemperature.CELSIUS, UnitOfTemperature.FAHRENHEIT, 0.555556),
    UnitlessRatioConverter: (PERCENTAGE, None, 100),
    VolumeConverter: (UnitOfVolume.GALLONS, UnitOfVolume.LITERS, 0.264172),
    VolumeFlowRateConverter: (UnitOfVolumeFlowRate.CUBIC_METERS_PER_HOUR, UnitOfVolumeFlowRate.LITERS_PER_MINUTE, 0.06)
}

_CONVERTED_VALUE: Dict[Type[BaseUnitConverter], List[Tuple[float, str, float, str]] = {
    AreaConverter: [(5, UnitOfArea.SQUARE_METERS, 50000, UnitOfArea.SQUARE_CENTIMETERS), (5, UnitOfArea.SQUARE_METERS, 5000000, UnitOfArea.SQUARE_MILLIMETERS), (5, UnitOfArea.SQUARE_METERS, 5e-06, UnitOfArea.SQUARE_KILOMETERS), (5, UnitOfArea.SQUARE_METERS, 7750.015500031001, UnitOfArea.SQUARE_INCHES), (5, UnitOfArea.SQUARE_METERS, 53.81955, UnitOfArea.SQUARE_FEET), (5, UnitOfArea.SQUARE_METERS, 5.979950231505403, UnitOfArea.SQUARE_YARDS), (5, UnitOfArea.SQUARE_METERS, 1.9305107927122295e-06, UnitOfArea.SQUARE_MILES), (5, UnitOfArea.SQUARE_METERS, 0.0012355269073358272, UnitOfArea.ACRES), (5, UnitOfArea.SQUARE_METERS, 0.0005, UnitOfArea.HECTARES), (1, UnitOfArea.SQUARE_KILOMETERS, 1000000, UnitOfArea.SQUARE_METERS), (1, UnitOfArea.SQUARE_KILOMETERS, 10000000000.0, UnitOfArea.SQUARE_CENTIMETERS), (1, UnitOfArea.SQUARE_KILOMETERS, 1000000000000.0, UnitOfArea.SQUARE_MILLIMETERS), (5, UnitOfArea.SQUARE_KILOMETERS, 1.9305107927122296, UnitOfArea.SQUARE_MILES), (5, UnitOfArea.SQUARE_KILOMETERS, 1235.5269073358272, UnitOfArea.ACRES), (5, UnitOfArea.SQUARE_KILOMETERS, 500, UnitOfArea.HECTARES), (5, UnitOfArea.ACRES, 20234.3, UnitOfArea.SQUARE_METERS), (5, UnitOfArea.ACRES, 202342821.11999995, UnitOfArea.SQUARE_CENTIMETERS), (5, UnitOfArea.ACRES, 20234282111.999992, UnitOfArea.SQUARE_MILLIMETERS), (5, UnitOfArea.ACRES, 0.0202343, UnitOfArea.SQUARE_KILOMETERS), (5, UnitOfArea.ACRES, 217800, UnitOfArea.SQUARE_FEET), (5, UnitOfArea.ACRES, 24200.0, UnitOfArea.SQUARE_YARDS), (5, UnitOfArea.ACRES, 0.0078125, UnitOfArea.SQUARE_MILES), (5, UnitOfArea.ACRES, 2.02343, UnitOfArea.HECTARES), (5, UnitOfArea.HECTARES, 50000, UnitOfArea.SQUARE_METERS), (5, UnitOfArea.HECTARES, 500000000, UnitOfArea.SQUARE_CENTIMETERS), (5, UnitOfArea.HECTARES, 50000000000.0, UnitOfArea.SQUARE_MILLIMETERS), (5, UnitOfArea.HECTARES, 0.019305107927122298, UnitOfArea.SQUARE_MILES), (5, UnitOfArea.HECTARES, 538195.5, UnitOfArea.SQUARE_FEET), (5, UnitOfArea.HECTARES, 59799.50231505403, UnitOfArea.SQUARE_YARDS), (5, UnitOfArea.HECTARES, 12.355269073358272, UnitOfArea.ACRES), (5, UnitOfArea.SQUARE_MILES, 12949940.551679997, UnitOfArea.SQUARE_METERS), (5, UnitOfArea.SQUARE_MILES, 129499405516.79997, UnitOfArea.SQUARE_CENTIMETERS), (5, UnitOfArea.SQUARE_MILES, 12949940551679.996, UnitOfArea.SQUARE_MILLIMETERS), (5, UnitOfArea.SQUARE_MILES, 1294.9940551679997, UnitOfArea.HECTARES), (5, UnitOfArea.SQUARE_MILES, 3200, UnitOfArea.ACRES), (5, UnitOfArea.SQUARE_YARDS, 4.1806367999999985, UnitOfArea.SQUARE_METERS), (5, UnitOfArea.SQUARE_YARDS, 41806.4, UnitOfArea.SQUARE_CENTIMETERS), (5, UnitOfArea.SQUARE_YARDS, 4180636.7999999984, UnitOfArea.SQUARE_MILLIMETERS), (5, UnitOfArea.SQUARE_YARDS, 4.180636799999998e-06, UnitOfArea.SQUARE_KILOMETERS), (5, UnitOfArea.SQUARE_YARDS, 45.0, UnitOfArea.SQUARE_FEET), (5, UnitOfArea.SQUARE_YARDS, 6479.999999999998, UnitOfArea.SQUARE_INCHES), (5, UnitOfArea.SQUARE_YARDS, 1.6141528925619832e-06, UnitOfArea.SQUARE_MILES), (5, UnitOfArea.SQUARE_YARDS, 0.0010330578512396695, UnitOfArea.ACRES)],
    BloodGlucoseConcentrationConverter: [(90, UnitOfBloodGlucoseConcentration.MILLIGRAMS_PER_DECILITER, 5, UnitOfBloodGlucoseConcentration.MILLIMOLE_PER_LITER), (1, UnitOfBloodGlucoseConcentration.MILLIMOLE_PER_LITER, 18, UnitOfBloodGlucoseConcentration.MILLIGRAMS_PER_DECILITER)],
    ConductivityConverter: [(5, UnitOfConductivity.SIEMENS, 5000.0, UnitOfConductivity.MILLISIEMENS), (5, UnitOfConductivity.SIEMENS, 5000000.0, UnitOfConductivity.MICROSIEMENS), (5, UnitOfConductivity.MILLISIEMENS, 5000.0, UnitOfConductivity.MICROSIEMENS), (5, UnitOfConductivity.MILLISIEMENS, 0.005, UnitOfConductivity.SIEMENS), (5000000.0, UnitOfConductivity.MICROSIEMENS, 5000.0, UnitOfConductivity.MILLISIEMENS), (5000000.0, UnitOfConductivity.MICROSIEMENS, 5, UnitOfConductivity.SIEMENS), (5, UnitOfConductivity.SIEMENS, 5000.0, UnitOfConductivity.MILLISIEMENS_PER_CM), (5, UnitOfConductivity.SIEMENS, 5000000.0, UnitOfConductivity.MICROSIEMENS_PER_CM), (5, UnitOfConductivity.MILLISIEMENS, 5000.0, UnitOfConductivity.MICROSIEMENS_PER_CM), (5, UnitOfConductivity.MILLISIEMENS, 0.005, UnitOfConductivity.SIEMENS_PER_CM), (5000000.0, UnitOfConductivity.MICROSIEMENS, 5000.0, UnitOfConductivity.MILLISIEMENS_PER_CM), (5000000.0, UnitOfConductivity.MICROSIEMENS, 5, UnitOfConductivity.SIEMENS_PER_CM), (5, UnitOfConductivity.SIEMENS_PER_CM, 5000.0, UnitOfConductivity.MILLISIEMENS), (5, UnitOfConductivity.SIEMENS_PER_CM, 5000000.0, UnitOfConductivity.MICROSIEMENS), (5, UnitOfConductivity.MILLISIEMENS_PER_CM, 5000.0, UnitOfConductivity.MICROSIEMENS), (5, UnitOfConductivity.MILLISIEMENS_PER_CM, 0.005, UnitOfConductivity.SIEMENS), (5000000.0, UnitOfConductivity.MICROSIEMENS_PER_CM, 5000.0, UnitOfConductivity.MILLISIEMENS), (5000000.0, UnitOfConductivity.MICROSIEMENS_PER_CM, 5, UnitOfConductivity.SIEMENS), (5, UnitOfConductivity.SIEMENS_PER_CM, 5000.0, UnitOfConductivity.MILLISIEMENS_PER_CM), (5, UnitOfConductivity.SIEMENS_PER_CM, 5000000.0, UnitOfConductivity.MICROSIEMENS_PER_CM), (5, UnitOfConductivity.MILLISIEMENS_PER_CM, 5000.0, UnitOfConductivity.MICROSIEMENS_PER_CM), (5, UnitOfConductivity.MILLISIEMENS_PER_CM, 0.005, UnitOfConductivity.SIEMENS_PER_CM), (5000000.0, UnitOfConductivity.MICROSIEMENS_PER_CM, 5000.0, UnitOfConductivity.MILLISIEMENS_PER_CM), (5000000.0, UnitOfConductivity.MICROSIEMENS_PER_CM, 5, UnitOfConductivity.SIEMENS_PER_CM)],
    DataRateConverter: [(8000.0, UnitOfDataRate.BITS_PER_SECOND, 8, UnitOfDataRate.KILOBITS_PER_SECOND), (8000000.0, UnitOfDataRate.BITS_PER_SECOND, 8, UnitOfDataRate.MEGABITS_PER_SECOND), (8000000000.0, UnitOfDataRate.BITS_PER_SECOND, 8, UnitOfDataRate.GIGABITS_PER_SECOND), (8, UnitOfDataRate.BITS_PER_SECOND, 1, UnitOfDataRate.BYTES_PER_SECOND), (8000.0, UnitOfDataRate.BITS_PER_SECOND, 1, UnitOfDataRate.KILOBYTES_PER_SECOND), (8000000.0, UnitOfDataRate.BITS_PER_SECOND, 1, UnitOfDataRate.MEGABYTES_PER_SECOND), (8000000000.0, UnitOfDataRate.BITS_PER_SECOND, 1, UnitOfDataRate.GIGABYTES_PER_SECOND), (8 * 2 ** 10, UnitOfDataRate.BITS_PER_SECOND, 1, UnitOfDataRate.KIBIBYTES_PER_SECOND), (8 * 2 ** 20, UnitOfDataRate.BITS_PER_SECOND, 1, UnitOfDataRate.MEBIBYTES_PER_SECOND), (8 * 2 ** 30, UnitOfDataRate.BITS_PER_SECOND, 1, UnitOfDataRate.GIBIBYTES_PER_SECOND)],
    DistanceConverter: [(5, UnitOfLength.MILES, 8.04672, UnitOfLength.KILOMETERS), (5, UnitOfLength.MILES, 8046.72, UnitOfLength.METERS), (5, UnitOfLength.MILES, 804672.0, UnitOfLength.CENTIMETERS), (5, UnitOfLength.MILES, 8046720.0, UnitOfLength.MILLIMETERS), (5, UnitOfLength.MILES, 8800.0, UnitOfLength.YARDS), (5, UnitOfLength.MILES, 26400.0008448, UnitOfLength.FEET), (5, UnitOfLength.MILES, 316800.171072, UnitOfLength.INCHES), (5, UnitOfLength.NAUTICAL_MILES, 9.26, UnitOfLength.KILOMETERS), (5, UnitOfLength.NAUTICAL_MILES, 9260.0, UnitOfLength.METERS), (5, UnitOfLength.NAUTICAL_MILES, 926000.0, UnitOfLength.CENTIMETERS), (5, UnitOfLength.NAUTICAL_MILES, 9260000.0, UnitOfLength.MILLIMETERS), (5, UnitOfLength.NAUTICAL_MILES, 10126.859142607176, UnitOfLength.YARDS), (5, UnitOfLength.NAUTICAL_MILES, 30380.57742782153, UnitOfLength.FEET), (5, UnitOfLength.NAUTICAL_MILES, 364566.9291338583, UnitOfLength.INCHES), (5, UnitOfLength.YARDS, 0.004572, UnitOfLength.KILOMETERS), (5, UnitOfLength.YARDS, 4.572, UnitOfLength.METERS), (5, UnitOfLength.YARDS, 457.2, UnitOfLength.CENTIMETERS), (5, UnitOfLength.YARDS, 4572, UnitOfLength.MILLIMETERS), (5, UnitOfLength.YARDS, 0.002840908212, UnitOfLength.MILES), (5, UnitOfLength.YARDS, 15.00000048, UnitOfLength.FEET), (5, UnitOfLength.YARDS, 180.0000972, UnitOfLength.INCHES), (5000, UnitOfLength.FEET, 1.524, UnitOfLength.KILOMETERS), (5000, Unit